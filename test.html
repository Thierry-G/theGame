<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Canvas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script>
        /**
         * Resize the canvas and calculate square size and space between squares.
         */
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            squareSize = Math.floor(canvas.width / matrix.cols);
            spaceBetweenSquares = Math.floor((canvas.width - squareSize * matrix.cols) / (matrix.cols + 1));
            drawSquares();
        }

        /**
         * Draw a square on the canvas.
         * @param {number} x - The x-coordinate of the top-left corner of the square.
         * @param {number} y - The y-coordinate of the top-left corner of the square.
         * @param {number} size - The size of the square.
         * @param {string} color - The fill color of the square.
         * @param {string} borderColor - The border color of the square.
         */
        function drawSquare(x, y, size, color, borderColor) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size);
            ctx.strokeStyle = borderColor;
            ctx.strokeRect(x, y, size, size);
        }

        /**
         * Draw all the squares on the canvas.
         */
        function drawSquares() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            squares.forEach((square) => {
                drawSquare(square.x, square.y, squareSize, square.color, square.borderColor);
            });
        }

        /**
         * Add a new square to the canvas.
         */
        function addSquare() {
            if (squares.length >= matrix.cols * matrix.rows) {
                return;
            }

            let row = Math.floor(squares.length / matrix.cols);
            let col = squares.length % matrix.cols;
            let x = col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
            let y = row * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;

            let newSquare = { id: squares.length + 1, row, col, x, y, color: 'blue', borderColor: 'black' };

            squares.push(newSquare);
            drawSquares();
        }

        /**
         * Move the squares on the canvas.
         */
        function moveSquares() {
            squares.forEach((square) => {
                // Only move squares in the last row to the right
                if (square.row === Math.floor(squares.length / matrix.cols)) {
                    square.x += spaceBetweenSquares;
                }

                if (square.x + squareSize > canvas.width) {
                    // When a square touches the right edge, reset all squares in the last row
                    squares.filter(sq => sq.row === square.row).forEach(sq => {
                        sq.x = sq.col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
                    });
                    // Add a new square to start a new row
                    addSquare();
                }

                if (square.y + squareSize > canvas.height) {
                    square.y = spaceBetweenSquares;
                }
            });

            drawSquares();
        }

        /**
         * Animate the movement of squares on the canvas.
         * @param {number} time - The current time.
         */
        function animate(time) {
            requestAnimationFrame(animate);
            if (time - lastTime > interval) {
                addSquare();
                moveSquares();
                lastTime = time;
            }
        }

        // Get the canvas element and its context
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');

        // Initialize variables
        let squares = [];
        let squareSize;
        let spaceBetweenSquares;

        let matrix = {
            cols: 4,
            rows: 4
        };

        let lastTime = 0;
        const interval = 900;

        // Resize the canvas when the window is resized
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Start the animation
        requestAnimationFrame(animate);
    </script>
</body>

</html>
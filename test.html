<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Canvas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let squares = [];
        let squareSize;
        let spaceBetweenSquares;

        let matrix = {
            cols: 4,
            rows: 4
        };

        let lastTime = Date.now();
        const interval = 900;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            squareSize = Math.floor(canvas.width / matrix.cols);
            spaceBetweenSquares = Math.floor((canvas.width - squareSize * matrix.cols) / (matrix.cols + 1));
            drawSquares();
        }

        function drawSquare(x, y, size, color, borderColor) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size);
            ctx.strokeStyle = borderColor;
            ctx.strokeRect(x, y, size, size);
        }

        function drawSquares() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            squares.forEach((square) => {
                drawSquare(square.x, square.y, squareSize, square.color, square.borderColor);
            });
        }

        function addSquare() {
            let row = Math.floor(squares.length / matrix.cols);
            let col = squares.length % matrix.cols;
            let x = col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
            let y = row * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;

            let newSquare = { id: squares.length + 1, row, col, x, y, color: 'blue', borderColor: 'black' };

            squares.push(newSquare);
            drawSquares();
        }

        function moveSquares() {
            squares.forEach((square) => {
                square.x += spaceBetweenSquares;

                if (square.x + squareSize > canvas.width) {
                    square.x = square.col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
                    if (square.row === matrix.rows - 1) {
                        square.y += squareSize + spaceBetweenSquares;
                        square.row = 0;
                    } else {
                        square.row++;
                    }
                }

                if (square.y + squareSize > canvas.height) {
                    square.y = spaceBetweenSquares;
                }
            });

            drawSquares();
        }

        function animate() {
            requestAnimationFrame(animate);
            let currentTime = Date.now();
            if (currentTime - lastTime > interval) {
                addSquare();
                moveSquares();
                lastTime = currentTime;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        requestAnimationFrame(animate);
    </script>
</body>

</html>
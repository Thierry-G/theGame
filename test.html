<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Canvas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let squares = [];
        let squareSize;
        let spaceBetweenSquares;

        let matrix = {
            cols: 4,
            rows: 4
        };

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            squareSize = Math.floor(canvas.width / matrix.cols);
            spaceBetweenSquares = Math.floor((canvas.width - squareSize * matrix.cols) / (matrix.cols + 1));
            drawSquares();
        }

        function drawSquare(x, y, size, color, borderColor) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size);
            ctx.strokeStyle = borderColor;
            ctx.strokeRect(x, y, size, size);
        }

        function drawSquares() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            squares.forEach((square) => {
                drawSquare(square.x, square.y, squareSize, square.color, square.borderColor);
            });
        }

        function addSquare() {
            if (squares.length >= matrix.cols * matrix.rows) {
                return;
            }

            let row = Math.floor(squares.length / matrix.cols);
            let col = squares.length % matrix.cols;
            let x = col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
            let y = row * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;

            let newSquare = { id: squares.length + 1, row, col, x, y, color: 'blue', borderColor: 'black' };

            squares.push(newSquare);
            drawSquares();
        }

        function moveSquares() {
            squares.forEach((square) => {
                // Only move squares in the last row to the right
                if (square.row === Math.floor(squares.length / matrix.cols)) {
                    square.x += spaceBetweenSquares;
                }

                if (square.x + squareSize > canvas.width) {
                    // When a square touches the right edge, reset all squares in the last row
                    squares.filter(sq => sq.row === square.row).forEach(sq => {
                        sq.x = sq.col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
                    });
                    // Add a new square to start a new row
                    addSquare();
                }

                if (square.y + squareSize > canvas.height) {
                    square.y = spaceBetweenSquares;
                }
            });

            drawSquares();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        setInterval(addSquare, 900);
        setInterval(moveSquares, 900);
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Canvas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            margin: auto;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <canvas id="myCanvas"></canvas>
    <script>
        const canvas = document.getElementById('myCanvas');
        const ctx = canvas.getContext('2d');
        let squares = [];
        let selectedSquare = null;
        let animationId = null;
        let spaceBetweenSquares;
        let squareSize;
        let allSquaresDisplayed = false;
        let furthestSquareInEachRow = [];

        let matrix = {
            cols: 4,
            rows: 4
        };

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const minDimension = Math.min(canvas.width, canvas.height);
            squareSize = Math.floor(minDimension / (matrix.cols + 1));
            spaceBetweenSquares = Math.floor((minDimension - squareSize * matrix.cols) / (matrix.cols + 1));
            drawSquares();
        }

        function drawSquare(x, y, size, color, borderColor) {
            ctx.fillStyle = color;
            ctx.fillRect(x, y, size, size);
            ctx.strokeStyle = borderColor;
            ctx.strokeRect(x, y, size, size);
        }

        function drawSquares() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            squares.forEach((square, index) => {
                let size = square === selectedSquare ? squareSize * 1.2 : squareSize;
                drawSquare(square.x, square.y, size, square.color, square.borderColor);
            });
        }

        function addSquare() {
            if (squares.length >= matrix.cols * matrix.rows) {
                allSquaresDisplayed = true;
                return;
            }

            let row = Math.floor(squares.length / matrix.cols);
            let col = squares.length % matrix.cols;
            let x = col * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;
            let y = row * (squareSize + spaceBetweenSquares) + spaceBetweenSquares;

            // Check for overlap with existing squares
            while (squares.some(square => square.x === x && square.y === y)) {
                x += squareSize + spaceBetweenSquares; // Move the new square to the right
                if (x >= canvas.width) { // If the new square is off the canvas, move it to the next row
                    x = spaceBetweenSquares;
                    y += squareSize + spaceBetweenSquares;
                }
            }

            let newSquare = { id: squares.length + 1, row, col, x, y, color: 'blue', borderColor: 'black', value: 1, startTime: new Date().getTime() };

            squares.push(newSquare); // Add new square at the end of the array
            furthestSquareInEachRow[row] = newSquare;

            drawSquares();
            displayGridInConsole();
        }
        
        function moveSquares() {
            // Update the positions of the squares
            squares.forEach((square, index) => {
                // Check if the square's row is full
                const isRowFull = squares.filter(s => s.row === square.row).length === matrix.cols;
                if (isRowFull) {
                    square.y += 5; // Move the square down
                } else {
                    square.x += 5; // Move the square to the right
                }
            });

            // Remove squares that have reached the bottom right edge
            squares = squares.filter(square => square.x < canvas.width && square.y < canvas.height);

            drawSquares();
            displayGridInConsole();
        }

        function displayGridInConsole() {
            let gridString = '';
            for (let row = 0; row < matrix.rows; row++) {
                for (let col = 0; col < matrix.cols; col++) {
                    const square = squares.find(square => square.row === row && square.col === col);
                    gridString += square ? 'X' : '_';
                }
                gridString += '\n';
            }
            console.log(gridString);
        }


        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        setInterval(() => {
            addSquare();
            moveSquares();
        }, 900)
    </script>
</body>

</html>